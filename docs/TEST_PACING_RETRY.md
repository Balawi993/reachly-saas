# ๐งช ุงุฎุชุจุงุฑ ูุธุงู Pacing & Retry

## ูุจู ุงูุจุฏุก

### 1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
node migrate-add-retry-fields.js
```

### 2. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ
```bash
npm run server
```

---

## ุงุฎุชุจุงุฑ 1: Messages per Minute โ

### ุงููุฏู
ุงูุชุฃูุฏ ูู ุฃู ุงููุธุงู ูุง ูุฑุณู ุฃูุซุฑ ูู ุงูุนุฏุฏ ุงููุญุฏุฏ ูู ุงูุฏูููุฉ

### ุงูุฎุทูุงุช
1. ุฃูุดุฆ ุญููุฉ ุจูุฐู ุงูุฅุนุฏุงุฏุงุช:
```
Messages per Minute: 3
Min Delay: 5 seconds
Max Delay: 10 seconds
Daily Cap: 20
Retry Attempts: 2
Targets: 10 ุฃูุฏุงู
```

2. ุดุบู ุงูุญููุฉ ูุฑุงูุจ Console

### ุงููุชูุฌุฉ ุงููุชููุนุฉ
```
๐ค [Campaign 1] Sending to @user1 (1/3 per min, 1/20 today)
โ [Campaign 1] Sent to @user1 - waiting 7.3s

๐ค [Campaign 1] Sending to @user2 (2/3 per min, 2/20 today)
โ [Campaign 1] Sent to @user2 - waiting 8.9s

๐ค [Campaign 1] Sending to @user3 (3/3 per min, 3/20 today)
โ [Campaign 1] Sent to @user3 - waiting 6.1s

[ุงูุชุธุงุฑ ~50 ุซุงููุฉ ุญุชู ุชูุฑ ุฏูููุฉ]

๐ค [Campaign 1] Sending to @user4 (1/3 per min, 4/20 today)
โ [Campaign 1] Sent to @user4 - waiting 9.2s
```

### ูุนุงููุฑ ุงููุฌุงุญ
- [ ] ูุง ูุชู ุฅุฑุณุงู ุฃูุซุฑ ูู 3 ุฑุณุงุฆู ูู ุฃู ูุงูุฐุฉ 60 ุซุงููุฉ
- [ ] ุงูุฑูู `(X/3 per min)` ูุง ูุชุฌุงูุฒ 3 ุฃุจุฏุงู
- [ ] ุจุนุฏ 3 ุฑุณุงุฆูุ ูุชู ุงูุงูุชุธุงุฑ ุญุชู ุชูุฑ ุฏูููุฉ

---

## ุงุฎุชุจุงุฑ 2: Retry Attempts โ

### ุงููุฏู
ุงูุชุฃูุฏ ูู ุฃู ุงููุธุงู ูุนูุฏ ุงููุญุงููุฉ ุนูุฏ ุงููุดู

### ุงูุฎุทูุงุช
1. ุฃูุดุฆ ุญููุฉ ุจุฃูุฏุงู ุบูุฑ ุตุญูุญุฉ (usernames ุบูุฑ ููุฌูุฏุฉ):
```
Messages per Minute: 5
Retry Attempts: 3
Targets: @nonexistent123, @fake456, @invalid789
```

2. ุดุบู ุงูุญููุฉ ูุฑุงูุจ Console

### ุงููุชูุฌุฉ ุงููุชููุนุฉ
```
๐ค [Campaign 1] Sending to @nonexistent123 (1/5 per min, 1/50 today)
โ๏ธ  [Campaign 1] Failed attempt 1/3 to @nonexistent123: User not found - will retry

๐ค [Campaign 1] Retry #2 to @nonexistent123 (2/5 per min, 2/50 today)
โ๏ธ  [Campaign 1] Failed attempt 2/3 to @nonexistent123: User not found - will retry

๐ค [Campaign 1] Retry #3 to @nonexistent123 (3/5 per min, 3/50 today)
โ [Campaign 1] Failed permanently to @nonexistent123 after 3 attempts: User not found
```

### ูุนุงููุฑ ุงููุฌุงุญ
- [ ] ูุชู ุฅุนุงุฏุฉ ุงููุญุงููุฉ 3 ูุฑุงุช
- [ ] ูุธูุฑ `Retry #X` ูู ุงููุญุงููุงุช ุงูุชุงููุฉ
- [ ] ุจุนุฏ 3 ูุญุงููุงุชุ ูุชู ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู `failed`
- [ ] ูุธูุฑ `Failed permanently after 3 attempts`

---

## ุงุฎุชุจุงุฑ 3: ููุน ุงูุชูุฑุงุฑ โ

### ุงููุฏู
ุงูุชุฃูุฏ ูู ุนุฏู ุฅุฑุณุงู ุฑุณุงูุฉ ูููุณ ุงููุณุชุฎุฏู ูุฑุชูู

### ุงูุฎุทูุงุช
1. ุฃูุดุฆ ุญููุฉ ุจุฃูุฏุงู ููุฑุฑุฉ:
```
Targets:
@user1
@user2
@user1  โ ููุฑุฑ
@user3
@user1  โ ููุฑุฑ
```

2. ุดุบู ุงูุญููุฉ

### ุงููุชูุฌุฉ ุงููุชููุนุฉ
```
๐ค [Campaign 1] Sending to @user1 (1/3 per min, 1/50 today)
โ [Campaign 1] Sent to @user1

๐ค [Campaign 1] Sending to @user2 (2/3 per min, 2/50 today)
โ [Campaign 1] Sent to @user2

โญ๏ธ  [Campaign 1] Skipped @user1 - already sent in this campaign

๐ค [Campaign 1] Sending to @user3 (3/3 per min, 3/50 today)
โ [Campaign 1] Sent to @user3

โญ๏ธ  [Campaign 1] Skipped @user1 - already sent in this campaign
```

### ูุนุงููุฑ ุงููุฌุงุญ
- [ ] ูุชู ุฅุฑุณุงู ุฑุณุงูุฉ ูุงุญุฏุฉ ููุท ููู ูุณุชุฎุฏู
- [ ] ุงููุญุงููุงุช ุงูููุฑุฑุฉ ูุชู ุชุฎุทููุง
- [ ] ูุธูุฑ `Skipped - already sent`

---

## ุงุฎุชุจุงุฑ 4: Daily Cap โ

### ุงููุฏู
ุงูุชุฃูุฏ ูู ุชููู ุงูุญููุฉ ุนูุฏ ุงููุตูู ููุญุฏ ุงููููู

### ุงูุฎุทูุงุช
1. ุฃูุดุฆ ุญููุฉ ุจุญุฏ ูููู ููุฎูุถ:
```
Messages per Minute: 5
Daily Cap: 5
Targets: 10 ุฃูุฏุงู
```

2. ุดุบู ุงูุญููุฉ

### ุงููุชูุฌุฉ ุงููุชููุนุฉ
```
๐ค [Campaign 1] Sending to @user1 (1/5 per min, 1/5 today)
โ [Campaign 1] Sent to @user1

๐ค [Campaign 1] Sending to @user2 (2/5 per min, 2/5 today)
โ [Campaign 1] Sent to @user2

๐ค [Campaign 1] Sending to @user3 (3/5 per min, 3/5 today)
โ [Campaign 1] Sent to @user3

๐ค [Campaign 1] Sending to @user4 (4/5 per min, 4/5 today)
โ [Campaign 1] Sent to @user4

๐ค [Campaign 1] Sending to @user5 (5/5 per min, 5/5 today)
โ [Campaign 1] Sent to @user5

โ๏ธ  Campaign 1 reached daily cap (5 attempts)
โธ๏ธ  Campaign 1 paused
```

### ูุนุงููุฑ ุงููุฌุงุญ
- [ ] ูุชู ุฅุฑุณุงู 5 ุฑุณุงุฆู ููุท
- [ ] ุชุชููู ุงูุญููุฉ ุชููุงุฆูุงู
- [ ] ูุธูุฑ `reached daily cap`
- [ ] ุงูุญุงูุฉ ุชุชุบูุฑ ุฅูู `paused`

---

## ุงุฎุชุจุงุฑ 5: Random Delay โ

### ุงููุฏู
ุงูุชุฃูุฏ ูู ุฃู ุงูุชุฃุฎูุฑ ุนุดูุงุฆู ุถูู ุงููุทุงู ุงููุญุฏุฏ

### ุงูุฎุทูุงุช
1. ุฃูุดุฆ ุญููุฉ:
```
Messages per Minute: 5
Min Delay: 10 seconds
Max Delay: 20 seconds
Targets: 5 ุฃูุฏุงู
```

2. ุฑุงูุจ ุฃููุงุช ุงูุงูุชุธุงุฑ ูู Console

### ุงููุชูุฌุฉ ุงููุชููุนุฉ
```
โ Sent to @user1 - waiting 12.3s
โ Sent to @user2 - waiting 18.7s
โ Sent to @user3 - waiting 15.1s
โ Sent to @user4 - waiting 11.9s
โ Sent to @user5 - waiting 19.4s
```

### ูุนุงููุฑ ุงููุฌุงุญ
- [ ] ุฌููุน ุงูุฃููุงุช ุจูู 10-20 ุซุงููุฉ
- [ ] ุงูุฃููุงุช ูุฎุชููุฉ (ููุณุช ุซุงุจุชุฉ)
- [ ] ุงูุชูุฒูุน ุนุดูุงุฆู

---

## ุงุฎุชุจุงุฑ 6: Retry Success โ

### ุงููุฏู
ุงูุชุฃูุฏ ูู ูุฌุงุญ ุงูุฅุฑุณุงู ูู ูุญุงููุฉ ูุงุญูุฉ

### ุงูุณููุงุฑูู
ุฑุณุงูุฉ ุชูุดู ูู ุงููุญุงููุฉ ุงูุฃููู ููู ุชูุฌุญ ูู ุงูุซุงููุฉ

### ุงููุชูุฌุฉ ุงููุชููุนุฉ
```
๐ค [Campaign 1] Sending to @user1 (1/3 per min, 1/50 today)
โ๏ธ  [Campaign 1] Failed attempt 1/3 to @user1: Rate limit - will retry

[ุจุนุฏ ูุชุฑุฉ]

๐ค [Campaign 1] Retry #2 to @user1 (1/3 per min, 2/50 today)
โ [Campaign 1] Retry succeeded to @user1 - waiting 18.3s
```

### ูุนุงููุฑ ุงููุฌุงุญ
- [ ] ูุชู ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- [ ] ุนูุฏ ุงููุฌุงุญุ ูุธูุฑ `Retry succeeded`
- [ ] ุงูุญุงูุฉ ุชุชุบูุฑ ุฅูู `sent`
- [ ] ูุง ูุชู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู

---

## ุงุฎุชุจุงุฑ 7: Database Integrity โ

### ุงููุฏู
ุงูุชุฃูุฏ ูู ุตุญุฉ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฎุทูุงุช
1. ุจุนุฏ ุชุดุบูู ุญููุฉุ ุงูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```sql
-- ูุญุต ุงูุฃูุฏุงู ุงููุงุฌุญุฉ
SELECT username, status, retry_count, sent_at 
FROM targets 
WHERE campaign_id = 1 AND status = 'sent';

-- ูุญุต ุงูุฃูุฏุงู ุงููุงุดูุฉ
SELECT username, status, retry_count, error_message 
FROM targets 
WHERE campaign_id = 1 AND status = 'failed';

-- ูุญุต ุงูุฃูุฏุงู ุงููุชุฎุทุงุฉ
SELECT username, status, error_message 
FROM targets 
WHERE campaign_id = 1 AND status = 'skipped';
```

### ูุนุงููุฑ ุงููุฌุงุญ
- [ ] ุงูุฃูุฏุงู ุงููุงุฌุญุฉ: `status = 'sent'`, `sent_at` ููุฌูุฏ
- [ ] ุงูุฃูุฏุงู ุงููุงุดูุฉ: `status = 'failed'`, `retry_count >= pacing_retry_attempts`
- [ ] ุงูุฃูุฏุงู ุงููุชุฎุทุงุฉ: `status = 'skipped'`, `error_message` ูุดุฑุญ ุงูุณุจุจ
- [ ] ูุง ุชูุฌุฏ ุฃูุฏุงู ุจุญุงูุฉ `sent` ููุฑุฑุฉ ูููุณ ุงููุณุชุฎุฏู

---

## ุงุฎุชุจุงุฑ 8: Server Restart โ

### ุงููุฏู
ุงูุชุฃูุฏ ูู ุงุณุชุฆูุงู ุงูุญููุงุช ุจุนุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ

### ุงูุฎุทูุงุช
1. ุดุบู ุญููุฉ
2. ุงูุชุธุฑ ุญุชู ูุชู ุฅุฑุณุงู ุจุนุถ ุงูุฑุณุงุฆู
3. ุฃููู ุงูุณูุฑูุฑ (Ctrl+C)
4. ุฃุนุฏ ุชุดุบูู ุงูุณูุฑูุฑ

### ุงููุชูุฌุฉ ุงููุชููุนุฉ
```
๐ Server running on http://localhost:3001
Resumed 1 active campaigns
โ Campaign 1 started
๐ค [Campaign 1] Sending to @user6 (1/3 per min, 6/50 today)
```

### ูุนุงููุฑ ุงููุฌุงุญ
- [ ] ูุชู ุงุณุชุฆูุงู ุงูุญููุงุช ุงููุดุทุฉ ุชููุงุฆูุงู
- [ ] ูุชู ุงูุงุญุชูุงุธ ุจู `retry_count` ููู ูุฏู
- [ ] ูุณุชูุฑ ุงูุฅุฑุณุงู ูู ุญูุซ ุชููู

---

## Checklist ุงูุดุงูู โ

### Pacing System
- [ ] Messages per Minute ููุญุชุฑู ุจุฏูุฉ
- [ ] Daily Cap ูุนูู ุจุดูู ุตุญูุญ
- [ ] Random Delay ุถูู ุงููุทุงู ุงููุญุฏุฏ
- [ ] ูุง ูุชู ุชุฌุงูุฒ ุงูุญุฏูุฏ ุฃุจุฏุงู

### Retry System
- [ ] ูุชู ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุนูุฏ ุงููุดู
- [ ] ุนุฏุฏ ุงููุญุงููุงุช ููุญุชุฑู
- [ ] ุงูุญุงูุฉ ุชุชุบูุฑ ุฅูู `failed` ุจุนุฏ ุงุณุชููุงุฏ ุงููุญุงููุงุช
- [ ] ุงููุฌุงุญ ูู ูุญุงููุฉ ูุงุญูุฉ ูุนูู ุจุดูู ุตุญูุญ

### Anti-Duplication
- [ ] ูุง ูุชู ุฅุฑุณุงู ุฑุณุงูุฉ ูููุณ ุงููุณุชุฎุฏู ูุฑุชูู
- [ ] ุงูุฃูุฏุงู ุงูููุฑุฑุฉ ูุชู ุชุฎุทููุง
- [ ] ุฑุณุงูุฉ ูุงุถุญุฉ ุนูุฏ ุงูุชุฎุทู

### Database
- [ ] ุฌููุน ุงูุญููู ุชูุญุฏุซ ุจุดูู ุตุญูุญ
- [ ] `retry_count` ูุฒูุฏ ูุน ูู ูุญุงููุฉ
- [ ] `last_attempt_at` ููุญุฏุซ
- [ ] `sent_at` ููุญุฏุซ ุนูุฏ ุงููุฌุงุญ ููุท

### Logging
- [ ] ูุนูููุงุช ููุตูุฉ ูู Console
- [ ] ุฃุฑูุงู ุฏูููุฉ (X/Y per min, Z/W today)
- [ ] ุฑุณุงุฆู ูุงุถุญุฉ ูููุฌุงุญ ูุงููุดู
- [ ] ุชูููุฒ ุจูู ุงููุญุงููุฉ ุงูุฃููู ูุงูุฅุนุงุฏุฉ

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ูุนูุฏ ุงููุญุงููุฉ
**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชุดุบูู migration: `node migrate-add-retry-fields.js`
2. ุชุญูู ูู `pacing_retry_attempts > 0`
3. ุฑุงุฌุน Console ููุฃุฎุทุงุก

### ุงููุดููุฉ: ูุฑุณู ุฃุณุฑุน ูู ุงููุชููุน
**ุงูุญู:**
1. ุฃุนุฏ ุชุดุบูู ุงูุณูุฑูุฑ
2. ุชุญูู ูู ุฅุนุฏุงุฏุงุช ุงูุญููุฉ
3. ุฑุงูุจ ุงูุฃุฑูุงู ูู Console

### ุงููุดููุฉ: ูุฑุณู ูููุณ ุงููุณุชุฎุฏู ูุฑุชูู
**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชุญุฏูุซ ุงูููุฏ
2. ุชุญูู ูู ุญุงูุฉ ุงูุฃูุฏุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุฃุนุฏ ุชุดุบูู ุงูุณูุฑูุฑ

---

**ููุงุญุธุฉ**: ูุฐู ุงุฎุชุจุงุฑุงุช ุดุงููุฉ. ููููู ุงุฎุชูุงุฑ ุงูุงุฎุชุจุงุฑุงุช ุงูููุงุณุจุฉ ูุงุญุชูุงุฌุงุชู.
